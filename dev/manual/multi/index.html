<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Multi-horizon · TimeStruct</title><meta name="title" content="Multi-horizon · TimeStruct"/><meta property="og:title" content="Multi-horizon · TimeStruct"/><meta property="twitter:title" content="Multi-horizon · TimeStruct"/><meta name="description" content="Documentation for TimeStruct."/><meta property="og:description" content="Documentation for TimeStruct."/><meta property="twitter:description" content="Documentation for TimeStruct."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">TimeStruct</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/basic_usage/">Basic usage</a></li><li><a class="tocitem" href="../../tutorials/battery_sizing/">Battery sizing</a></li></ul></li><li><span class="tocitem">Showcases</span><ul><li><a class="tocitem" href="../../showcases/emx/">EnergyModelsX</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../basic/">Operational time structures</a></li><li class="is-active"><a class="tocitem" href>Multi-horizon</a><ul class="internal"><li><a class="tocitem" href="#man-multi-twolevel"><span>TwoLevel structure</span></a></li><li><a class="tocitem" href="#man-multi-twoleveltree"><span>TwoLevelTree structure</span></a></li></ul></li><li><a class="tocitem" href="../profiles/">Time profiles</a></li><li><a class="tocitem" href="../iteration/">Iteration utilities</a></li><li><a class="tocitem" href="../discount/">Discounting</a></li></ul></li><li><a class="tocitem" href="../../contribute/">Contribute</a></li><li><a class="tocitem" href="../../reference/api/">API reference</a></li><li><a class="tocitem" href="../../reference/internal/">Internal reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Multi-horizon</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Multi-horizon</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sintefore/TimeStruct.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/sintefore/TimeStruct.jl/blob/main/docs/src/manual/multi.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="man-multi"><a class="docs-heading-anchor" href="#man-multi">Multi-horizon time structures</a><a id="man-multi-1"></a><a class="docs-heading-anchor-permalink" href="#man-multi" title="Permalink"></a></h1><h2 id="man-multi-twolevel"><a class="docs-heading-anchor" href="#man-multi-twolevel">TwoLevel structure</a><a id="man-multi-twolevel-1"></a><a class="docs-heading-anchor-permalink" href="#man-multi-twolevel" title="Permalink"></a></h2><p>The main motivation for the <code>TimeStruct</code> package is to support multi-horizon optimization models. The time structure <a href="../../reference/api/#TimeStruct.TwoLevel"><code>TwoLevel</code></a> allows for a two level approach, combining an ordered sequence of strategic periods with given duration and an associated operational time structure.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using TimeStruct</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; periods = TwoLevel(
           [SimpleTimes(5,1), SimpleTimes(5,1), SimpleTimes(5,1)],
       );</code></pre><p><img src="../../figures/twolevel.png" alt="Illustration of TwoLevel"/></p><p>The following example shows a typical usage of a <a href="../../reference/api/#TimeStruct.TwoLevel"><code>TwoLevel</code></a> structure with investment decisions on a strategic level and operational decision variables. It is possible to iterate through each strategic period using the <a href="../../reference/api/#TimeStruct.strat_periods"><code>strat_periods</code></a>function.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using JuMP</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; m = Model();</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @variable(m, invest[strat_periods(periods)] &gt;= 0);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @variable(m, prod[periods] &gt;= 0);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; for sp in strat_periods(periods)
           @constraint(m, sum(prod[t] for t in sp) &lt;= invest[sp])
       end</code></pre><p>It is also possible to combine a <a href="../../reference/api/#TimeStruct.TwoLevel"><code>TwoLevel</code></a> time structure with more complex operational structures like <a href="../../reference/api/#TimeStruct.RepresentativePeriods"><code>RepresentativePeriods</code></a> and <a href="../../reference/api/#TimeStruct.OperationalScenarios"><code>OperationalScenarios</code></a>, alone or in combination, as shown in the following example and illustrated the figure below.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; oper = SimpleTimes(5,1);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; scen = OperationalScenarios([oper, oper, oper], [0.4, 0.5, 0.1]);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; repr = RepresentativePeriods(2, 5, [0.5, 0.5], [oper, oper]);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; repr_scen = RepresentativePeriods(2, 5, [0.5, 0.5], [scen, scen]);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; periods = TwoLevel([scen, repr, repr_scen]);</code></pre><p><img src="../../figures/two_complex.png" alt="Complex TwoLevel"/></p><p>In the above examples, the duration of the operational time structures have been equal to the duration of the strategic periods, but this is not required. If the duration of the operational time structure is shorter than the strategic period, this will be accounted for with the <a href="../../reference/api/#TimeStruct.multiple"><code>multiple</code></a> function.</p><p>It is also sometimes convenient to use a different time unit for the strategic periods than the operational time periods. This is controlled by the <code>op_per_strat</code> field of the <a href="../../reference/api/#TimeStruct.TwoLevel"><code>TwoLevel</code></a> structure that holds the number of operational periods per strategic period.</p><p>A typical use case is an investment problem where one uses years to measure duration at the strategic level and hours/days on the operational level. Below is an example with 3 strategic periods of duration 5, 5, and 10 years respectively, while the operational time structure is given by representative periods with duration in days. The <code>op_per_strat</code> is then set to 365.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; week = SimpleTimes(7,1);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; repr = RepresentativePeriods(2, 365, [0.6, 0.4], [week, week]);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; periods = TwoLevel(3, [5, 5, 10], [repr, repr, repr], 365.0);</code></pre><h2 id="man-multi-twoleveltree"><a class="docs-heading-anchor" href="#man-multi-twoleveltree">TwoLevelTree structure</a><a id="man-multi-twoleveltree-1"></a><a class="docs-heading-anchor-permalink" href="#man-multi-twoleveltree" title="Permalink"></a></h2><p>If there is uncertainty at a strategic level, this can be incorporated using the <a href="../../reference/api/#TimeStruct.TwoLevelTree"><code>TwoLevelTree</code></a> time structure. This structure is represented by a tree, with each node corresponding to a strategic period that contains an operational time structure. The operational time structure can be any combination of the <em><a href="../basic/#man-oper">described structures</a></em>.</p><p>The following example demonstrates how to create a regular tree through a constructor (<code>TwoLevelTree(duration::S, branching::Vector, ts::OP; op_per_strat::Float64 = 1.0) where {S,T,OP&lt;:TimeStructure{T}}</code>) where each strategic period spans 3 years and is represented by a week with daily resolution. The second  argument of the constructor function specifies the number of branches at each stage of the tree, excluding the first stage.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using TimeStruct</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; week = SimpleTimes(7, 1);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; two_level_tree = TwoLevelTree(3, [3, 2], week; op_per_strat = 52.0);</code></pre><p><img src="../../figures/two_level_tree.png" alt="Illustration of TwoLevelTree"/></p><p>The branching probabilities are equal for all branches as indicated in green in the figure.</p><p>We also provide the possibility of having differing tree structures through the application of the <a href="../../reference/api/#TimeStruct.TreeNode"><code>TreeNode</code></a> type. A <a href="../../reference/api/#TimeStruct.TreeNode"><code>TreeNode</code></a> approach for above&#39;s time structure would be given by</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using TimeStruct</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; week = SimpleTimes(7, 1);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; two_level_tree = TwoLevelTree(
           TreeNode(3, week, [
               TreeNode(3, week, 2,
                   TreeNode(3, week)
               )
               TreeNode(3, week, [0.5, 0.5],
                   TreeNode(3, week)
               )
               TreeNode(3, week, [
                   TreeNode(3, week),
                   TreeNode(3, week),
               ])
           ]);
           op_per_strat = 52.0
       )</code><code class="nohighlight hljs ansi" style="display:block;">TwoLevelTree{Int64, Int64, TimeStruct.StratNode{Int64, Int64, SimpleTimes{Int64}}}(3, sp1-br1, TimeStruct.StratNode{Int64, Int64, SimpleTimes{Int64}}[sp1-br1, sp2-br1, sp3-br1, sp3-br2, sp2-br2, sp3-br3, sp3-br4, sp2-br3, sp3-br5, sp3-br6], 52.0)</code></pre><p>Similar as for <a href="../../reference/api/#TimeStruct.TwoLevel"><code>TwoLevel</code></a>, the strategic nodes can be iterated using <a href="../../reference/api/#TimeStruct.strat_periods"><code>strat_periods</code></a>. It is possible to connect the nodes to their predecessor by iterating using the <a href="../../reference/api/#TimeStruct.withprev"><code>withprev</code></a> iterator that returns a tuple with the parent or nothing if no parent, together with the node itself. This provides the flexibility to track decisions in the tree as shown by the following example that allows investment into new capacity in each strategic node while tracking the accumulated capacity.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using JuMP</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; m = Model();</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; strat_pers = strat_periods(two_level_tree);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @variable(m, invest[strat_pers], Bin);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @variable(m, cap[strat_pers] &gt;= 0);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; for (prev, sp) in withprev(strat_pers)
           if !isnothing(prev)
               @constraint(m, cap[sp] == cap[prev] + 10 * invest[prev])
           end
       end</code></pre><p>To ensure consistency across the tree, it is possible to iterate through all strategic scenarios in the tree using <a href="../../reference/api/#TimeStruct.strategic_scenarios"><code>strategic_scenarios</code></a>. Here each scenario is a path from the root node to one of the leaves of the tree. In the example above, if we only allow one investment in the planning period, this can be added by restricting the number of investments in each scenario:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; for sc in strategic_scenarios(two_level_tree)
           @constraint(m, sum(invest[sp] for sp in strat_periods(sc)) &lt;= 1)
       end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../basic/">« Operational time structures</a><a class="docs-footer-nextpage" href="../profiles/">Time profiles »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Monday 3 November 2025 20:12">Monday 3 November 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
