<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Iteration utilities · TimeStruct</title><meta name="title" content="Iteration utilities · TimeStruct"/><meta property="og:title" content="Iteration utilities · TimeStruct"/><meta property="twitter:title" content="Iteration utilities · TimeStruct"/><meta name="description" content="Documentation for TimeStruct."/><meta property="og:description" content="Documentation for TimeStruct."/><meta property="twitter:description" content="Documentation for TimeStruct."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">TimeStruct</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/basic_usage/">Basic usage</a></li><li><a class="tocitem" href="../../tutorials/battery_sizing/">Battery sizing</a></li></ul></li><li><span class="tocitem">Showcases</span><ul><li><a class="tocitem" href="../../showcases/emx/">EnergyModelsX</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../basic/">Operational time structures</a></li><li><a class="tocitem" href="../multi/">Multi-horizon</a></li><li><a class="tocitem" href="../profiles/">Time profiles</a></li><li class="is-active"><a class="tocitem" href>Iteration utilities</a><ul class="internal"><li><a class="tocitem" href="#man-iter-basic"><span>Basic iteration</span></a></li><li><a class="tocitem" href="#man-iter-prev"><span>Iteration with previous</span></a></li><li><a class="tocitem" href="#man-iter-chunk"><span>Iteration with chunks of time periods</span></a></li><li><a class="tocitem" href="#man-iter-chunk_dur"><span>Chunks based on duration</span></a></li><li><a class="tocitem" href="#man-iter-index"><span>Indexing of operational time structures</span></a></li></ul></li><li><a class="tocitem" href="../discount/">Discounting</a></li></ul></li><li><a class="tocitem" href="../../contribute/">Contribute</a></li><li><a class="tocitem" href="../../reference/api/">API reference</a></li><li><a class="tocitem" href="../../reference/internal/">Internal reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Iteration utilities</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Iteration utilities</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sintefore/TimeStruct.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/sintefore/TimeStruct.jl/blob/main/docs/src/manual/iteration.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="man-iter"><a class="docs-heading-anchor" href="#man-iter">Iteration utilities</a><a id="man-iter-1"></a><a class="docs-heading-anchor-permalink" href="#man-iter" title="Permalink"></a></h1><h2 id="man-iter-basic"><a class="docs-heading-anchor" href="#man-iter-basic">Basic iteration</a><a id="man-iter-basic-1"></a><a class="docs-heading-anchor-permalink" href="#man-iter-basic" title="Permalink"></a></h2><p>All time structures are iterable over their operational time periods</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using TimeStruct</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; function iterate_ex(periods::TimeStructure)
           for t in periods
               println(t)
           end
       end</code><code class="nohighlight hljs ansi" style="display:block;">iterate_ex (generic function with 1 method)</code></pre><h2 id="man-iter-prev"><a class="docs-heading-anchor" href="#man-iter-prev">Iteration with previous</a><a id="man-iter-prev-1"></a><a class="docs-heading-anchor-permalink" href="#man-iter-prev" title="Permalink"></a></h2><p>In many settings, e.g. tracking of storage, it is convenient to have access to the previous time period. By using the custom iterator <a href="../../reference/api/#TimeStruct.withprev"><code>withprev</code></a> it is possible to return both the previous and current time period as a tuple when iterating:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using TimeStruct</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; periods = SimpleTimes(5, 1);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; collect(withprev(periods))</code><code class="nohighlight hljs ansi" style="display:block;">5-element Vector{Any}:
 (nothing, t1)
 (t1, t2)
 (t2, t3)
 (t3, t4)
 (t4, t5)</code></pre><h2 id="man-iter-chunk"><a class="docs-heading-anchor" href="#man-iter-chunk">Iteration with chunks of time periods</a><a id="man-iter-chunk-1"></a><a class="docs-heading-anchor-permalink" href="#man-iter-chunk" title="Permalink"></a></h2><p>Sometimes it is convenient to iterate through the time periods as chunks of a fixed number of periods or minimum duration, e.g. in production planning with minimum production runs. To simplify this process there are several iterator wrappers that allows this kind of iteration pattern.</p><p>The <a href="../../reference/api/#TimeStruct.chunk"><code>chunk</code></a> function iterates through a time structure returning subsequences of length at most <code>n</code> starting at each time period.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; periods = SimpleTimes(5,1)</code><code class="nohighlight hljs ansi" style="display:block;">SimpleTimes{Int64}(5, [1, 1, 1, 1, 1])</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; collect(collect(ts) for ts in chunk(periods, 3))</code><code class="nohighlight hljs ansi" style="display:block;">5-element Vector{Vector{TimeStruct.SimplePeriod{Int64}}}:
 [t1, t2, t3]
 [t2, t3, t4]
 [t3, t4, t5]
 [t4, t5]
 [t5]</code></pre><p>This wrapper can be used for e.g. modelling of startup modelling with a minimum uptime. The following example shows how this can be implemented as part of a JuMP model:</p><pre><code class="language-julia hljs">using JuMP, TimeStruct

periods = SimpleTimes(5,1)

m = Model()
@variable(m, startup[periods], Bin)
@variable(m, shutdown[periods], Bin)

for ts in chunk(periods, 3)
    @constraint(m, sum(shutdown[t] for t in ts) &lt;= 3 * (1 - startup[first(ts)]))
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3 startup[t1] + shutdown[t1] + shutdown[t2] + shutdown[t3] ≤ 3
3 startup[t2] + shutdown[t2] + shutdown[t3] + shutdown[t4] ≤ 3
3 startup[t3] + shutdown[t3] + shutdown[t4] + shutdown[t5] ≤ 3
3 startup[t4] + shutdown[t4] + shutdown[t5] ≤ 3
3 startup[t5] + shutdown[t5] ≤ 3</code></pre><p>Similarly, if modelling startup decisions with a minimum downtime, it is possible to reverse the original time periods and then chunk:</p><pre><code class="language-julia hljs">for ts in chunk(Iterators.reverse(periods), 3)
    @constraint(m, sum(shutdown[t] for t in ts) &lt;= 3 * (1 - startup[first(ts)]))
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3 startup[t5] + shutdown[t3] + shutdown[t4] + shutdown[t5] ≤ 3
3 startup[t4] + shutdown[t2] + shutdown[t3] + shutdown[t4] ≤ 3
3 startup[t3] + shutdown[t1] + shutdown[t2] + shutdown[t3] ≤ 3
3 startup[t2] + shutdown[t1] + shutdown[t2] ≤ 3
3 startup[t1] + shutdown[t1] ≤ 3</code></pre><p>It is also possible to get cyclic behaviour by setting the <code>cyclic</code> argument to <code>true</code>. If reaching the end before the required number of time periods, the chunk will continue from the first time period.</p><pre><code class="language-julia hljs">for ts in chunk(periods, 3; cyclic = true)
    @constraint(m, sum(shutdown[t] for t in ts) &lt;= 3 * (1 - startup[first(ts)]))
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3 startup[t1] + shutdown[t1] + shutdown[t2] + shutdown[t3] ≤ 3
3 startup[t2] + shutdown[t2] + shutdown[t3] + shutdown[t4] ≤ 3
3 startup[t3] + shutdown[t3] + shutdown[t4] + shutdown[t5] ≤ 3
3 startup[t4] + shutdown[t1] + shutdown[t4] + shutdown[t5] ≤ 3
3 startup[t5] + shutdown[t1] + shutdown[t2] + shutdown[t5] ≤ 3</code></pre><h2 id="man-iter-chunk_dur"><a class="docs-heading-anchor" href="#man-iter-chunk_dur">Chunks based on duration</a><a id="man-iter-chunk_dur-1"></a><a class="docs-heading-anchor-permalink" href="#man-iter-chunk_dur" title="Permalink"></a></h2><p>If working with a time structure that has varying duration for its time periods, it can be more convenient with chunks based on their combined duration.</p><p>The <a href="../../reference/api/#TimeStruct.chunk_duration"><code>chunk_duration</code></a> function iterates through a time structure returning subsequences of duration at least <code>dur</code> starting at each time period.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; periods = SimpleTimes(5,[1, 2, 1, 1.5, 0.5, 2])</code><code class="nohighlight hljs ansi" style="display:block;">SimpleTimes{Float64}(5, [1.0, 2.0, 1.0, 1.5, 0.5, 2.0])</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; collect(collect(ts) for ts in chunk_duration(periods, 3))</code><code class="nohighlight hljs ansi" style="display:block;">5-element Vector{Vector{TimeStruct.SimplePeriod{Float64}}}:
 [t1, t2]
 [t2, t3]
 [t3, t4, t5]
 [t4, t5]
 [t5]</code></pre><h2 id="man-iter-index"><a class="docs-heading-anchor" href="#man-iter-index">Indexing of operational time structures</a><a id="man-iter-index-1"></a><a class="docs-heading-anchor-permalink" href="#man-iter-index" title="Permalink"></a></h2><p>It is possible to use indices for operational time structures, either directly using <a href="../../reference/api/#TimeStruct.SimpleTimes"><code>SimpleTimes</code></a> or <a href="../../reference/api/#TimeStruct.CalendarTimes"><code>CalendarTimes</code></a> or by accessing an operational scenario.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; periods = TwoLevel(3, 100, SimpleTimes(10,1));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; scenario = first(opscenarios(periods))</code><code class="nohighlight hljs ansi" style="display:block;">sp1-sc1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; scenario[3]</code><code class="nohighlight hljs ansi" style="display:block;">sp1-t3</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../profiles/">« Time profiles</a><a class="docs-footer-nextpage" href="../discount/">Discounting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Tuesday 4 March 2025 08:53">Tuesday 4 March 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
