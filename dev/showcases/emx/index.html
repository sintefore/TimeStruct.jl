<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>EnergyModelsX · TimeStruct</title><meta name="title" content="EnergyModelsX · TimeStruct"/><meta property="og:title" content="EnergyModelsX · TimeStruct"/><meta property="twitter:title" content="EnergyModelsX · TimeStruct"/><meta name="description" content="Documentation for TimeStruct."/><meta property="og:description" content="Documentation for TimeStruct."/><meta property="twitter:description" content="Documentation for TimeStruct."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">TimeStruct</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/basic_usage/">Basic usage</a></li><li><a class="tocitem" href="../../tutorials/battery_sizing/">Battery sizing</a></li></ul></li><li><span class="tocitem">Showcases</span><ul><li class="is-active"><a class="tocitem" href>EnergyModelsX</a><ul class="internal"><li><a class="tocitem" href="#show-emx-core"><span>Implementation of the core structures</span></a></li><li><a class="tocitem" href="#show-emx-adv"><span>Advanced utilization</span></a></li></ul></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/basic/">Operational time structures</a></li><li><a class="tocitem" href="../../manual/multi/">Multi-horizon</a></li><li><a class="tocitem" href="../../manual/profiles/">Time profiles</a></li><li><a class="tocitem" href="../../manual/iteration/">Iteration utilities</a></li><li><a class="tocitem" href="../../manual/discount/">Discounting</a></li></ul></li><li><a class="tocitem" href="../../contribute/">Contribute</a></li><li><a class="tocitem" href="../../reference/api/">API reference</a></li><li><a class="tocitem" href="../../reference/internal/">Internal reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Showcases</a></li><li class="is-active"><a href>EnergyModelsX</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>EnergyModelsX</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sintefore/TimeStruct.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/sintefore/TimeStruct.jl/blob/main/docs/src/showcases/emx.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="show-emx"><a class="docs-heading-anchor" href="#show-emx">EnergyModelsX</a><a id="show-emx-1"></a><a class="docs-heading-anchor-permalink" href="#show-emx" title="Permalink"></a></h1><p><strong><a href="https://github.com/EnergyModelsX">EnergyModelsX (EMX)</a></strong> is a flexible multi-horizon energy system optimization framework using <a href="https://jump.dev/JuMP.jl/stable/"><code>JuMP</code></a>. It utilizes <code>TimeStruct</code> from the beginning and influenced some of the added features of <code>TimeStruct</code>. Its implemtation is outlined in the following sections.</p><h2 id="show-emx-core"><a class="docs-heading-anchor" href="#show-emx-core">Implementation of the core structures</a><a id="show-emx-core-1"></a><a class="docs-heading-anchor-permalink" href="#show-emx-core" title="Permalink"></a></h2><p>The core package <code>EnergyModelsBase</code> differentiates between variables indexed over strategic periods and variables indexed over operational period, similar to the battery sizing example. As an example, consider the following two functions for variable declaration for a given <code>𝒯::TimeStructure</code>:</p><ul><li><p><a href="https://github.com/EnergyModelsX/EnergyModelsBase.jl/blob/10036d91949e69cae0fbdb8e1652b85d7f82742a/src/model.jl#L175"><code>variables_capacity(m, 𝒩::Vector{&lt;:Node}, 𝒳ᵛᵉᶜ, 𝒯, modeltype::EnergyModel)</code></a> with, among others,</p><pre><code class="language-julia hljs">@variable(m, cap_use[𝒩ᶜᵃᵖ, 𝒯] &gt;= 0)
@variable(m, cap_inst[𝒩ᶜᵃᵖ, 𝒯] &gt;= 0)</code></pre></li><li><p><a href="https://github.com/EnergyModelsX/EnergyModelsBase.jl/blob/10036d91949e69cae0fbdb8e1652b85d7f82742a/src/model.jl#L297C10-L297C82"><code>variables_opex(m, 𝒩::Vector{&lt;:Node}, 𝒳ᵛᵉᶜ, 𝒯, modeltype::EnergyModel)</code></a> with, among others,</p><pre><code class="language-julia hljs">𝒯ᴵⁿᵛ = strategic_periods(𝒯)
@variable(m, opex_var[𝒩ᵒᵖᵉˣ, 𝒯ᴵⁿᵛ])</code></pre></li></ul><p>These two functions highlight the simplicity of using <code>TimeStruct</code> as the individual time structures allow for iterations within <code>JuMP</code> macros. In addition, it simplifies the index sets as changing the number of intermediate time structures through incorporating, <em>e.g.</em>, <a href="../../manual/basic/#man-oper-osc"><code>OperationalScenarios</code></a>, does not require changes to the variable declarations. The change in the structure through the incorporation of the operational scenarios is instead available within the individual <code>TimePeriod</code> type.</p><p>The same is also true for constraint functions as shown in <a href="https://github.com/EnergyModelsX/EnergyModelsBase.jl/blob/10036d91949e69cae0fbdb8e1652b85d7f82742a/src/constraint_functions.jl#L17"><code>constraints_capacity(m, n::Node, 𝒯::TimeStructure, modeltype::EnergyModel)</code></a>:</p><pre><code class="language-julia hljs">@constraint(m, [t ∈ 𝒯], m[:cap_use][n, t] &lt;= m[:cap_inst][n, t])</code></pre><p>Variables whose values are dependent on the previous operational period are only available for <code>Storage</code> nodes. Its implementation is rather complex, but it is entirely relying on the <a href="../../manual/iteration/#man-iter-prev"><code>withprev</code></a> functionality to decide whether it is the first operational period in a different <code>TimeStructure</code> as well as how it must behave in this situation.</p><p>The individual operational periods are linked in <code>EnergyModelsBase</code> through the internal function <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/functions/#EnergyModelsBase.scale_op_sp"><code>scale_op_sp</code></a> for the multiplication</p><p class="math-container">\[duration(t) * multiple\_strat(t_{inv}, t) * probability(t)\]</p><p>where <span>$t$</span> corresponds to an operational period and <span>$t_{inv}$</span> to a strategic period.</p><h2 id="show-emx-adv"><a class="docs-heading-anchor" href="#show-emx-adv">Advanced utilization</a><a id="show-emx-adv-1"></a><a class="docs-heading-anchor-permalink" href="#show-emx-adv" title="Permalink"></a></h2><h3 id="show-emx-adv-withprev"><a class="docs-heading-anchor" href="#show-emx-adv-withprev"><code>withprev</code> and its application</a><a id="show-emx-adv-withprev-1"></a><a class="docs-heading-anchor-permalink" href="#show-emx-adv-withprev" title="Permalink"></a></h3><p>As outlined, neither <a href="../../manual/basic/#man-oper-osc"><code>OperationalScenarios</code></a> or <a href="../../manual/basic/#man-oper-repr"><code>RepresentativePeriods</code></a> where available in the initial development of <strong>EMX</strong>. However, the adjustments towards including these were limited to constraints that require the previous periods, that is constraints declared through the <a href="../../manual/iteration/#man-iter-prev"><code>withprev</code></a> functionality. All other constraints did not require any changes as the respective <code>TimePeriod</code>s included the required information.</p><p>The implementation of the the <em><a href="https://github.com/EnergyModelsX/EnergyModelsBase.jl/blob/10036d91949e69cae0fbdb8e1652b85d7f82742a/src/constraint_functions.jl#L194C10-L195C1"><code>Storage</code> level balance</a></em> provides an example on how <code>TimeStruct</code> can be used. It iterates through all potential subtypes of the given <code>TimeStructure</code>. Multiple dispatch is included to identify whether the <code>TimeStructure</code> includes <code>OperationalScenarios</code> or <code>RepresentativePeriods</code>. If this is the case, additional constraints can be incorporated. Due to the iteration (and storing) of all previous periods, it is possible to identify exactly what constraint should be utilized for the first operational period in a given <code>TimeStructure</code>.</p><div class="admonition is-success" id="Proposed-workflow-c1c17d246f02be1c"><header class="admonition-header">Proposed workflow<a class="admonition-anchor" href="#Proposed-workflow-c1c17d246f02be1c" title="Permalink"></a></header><div class="admonition-body"><p>While it can be tempting to design models from the initial stage to include both operational scenarios and representative periods, it is beneficial to avoid including these. <code>TimeStruct</code> simplifies the introduction of either <code>TimeStructure</code> in a latter stage. It is hence significantly easier to develop a model without considering complex time structures.</p><p>If you do not have any constraints depending on the previous periods, you even do not have to do any changes to your model when including <code>OperationalScenarios</code> or <code>RepresentativePeriods</code>.</p></div></div><h3 id="show-emx-adv-chunk"><a class="docs-heading-anchor" href="#show-emx-adv-chunk">Chunks for unit commitment</a><a id="show-emx-adv-chunk-1"></a><a class="docs-heading-anchor-permalink" href="#show-emx-adv-chunk" title="Permalink"></a></h3><p>The functionality of <code>TimeStruct</code> for chunks based on the minimum required time is utilized in the <em><a href="https://github.com/EnergyModelsX/EnergyModelsHydrogen.jl/blob/88a21ffae88b7ce199752aa5465313ad549718b6/src/constraints/reformer.jl#L259">unit commitment constraints of <code>Reformer</code> nodes</a></em> in <a href="https://energymodelsx.github.io/EnergyModelsHydrogen.jl/stable/"><code>EnergyModelsHydrogen</code></a>. In this context, we require a minimum time for starting the node, shutting the node down, and when the node is offline due to limitations in the dynamics of the chemical plant.</p><p>The used approach is similar to the <code>Storage</code> level balance utilizing the <a href="../../manual/iteration/#man-iter-prev"><code>withprev</code></a> functionality for the majority of the time structures. However, once on the lowest level, <a href="../../manual/iteration/#man-iter-chunk_dur"><code>chunk_duration</code></a> is used in addition to provide limits on changes between the different states. The <code>eltype</code>s of the iterator allows for further iterations to have access to the number of operational periods.</p><h3 id="show-emx-adv-strat"><a class="docs-heading-anchor" href="#show-emx-adv-strat">Including strategic uncertainty</a><a id="show-emx-adv-strat-1"></a><a class="docs-heading-anchor-permalink" href="#show-emx-adv-strat" title="Permalink"></a></h3><p><strong>EMX</strong> was not tested to also include strategic uncertainty as described in <em><a href="../../manual/multi/#man-multi-twoleveltree">TwoLevelTree structure</a></em>. The basic functionalities of <code>EnergyModelsBase</code> and the majority of the developed packages do however not have any problems with incorporating strategic uncertainty as the strategic periods are not linked. In this case, the internal structure of <code>TimeStruct</code> allows the direct inclusion of strategic uncertainty without changes to the model. The exception if when using the <a href="../../manual/iteration/#man-iter-prev"><code>withprev</code></a> functionality on strategic periods as it is the case for the investments in <a href="https://energymodelsx.github.io/EnergyModelsInvestments.jl/stable/"><code>EnergyModelsInvestments</code></a>. However, it is expected that the inclusion does not require any changes directly to the code structure due to the function overload on the <a href="../../manual/iteration/#man-iter-prev"><code>withprev</code></a> functionality.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../tutorials/battery_sizing/">« Battery sizing</a><a class="docs-footer-nextpage" href="../../manual/basic/">Operational time structures »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Monday 23 June 2025 12:19">Monday 23 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
